# 小芽家教 - Ralph Loop 迭代提示词

## 项目背景

小芽家教（SproutChat）是面向一年级学生的 AI-First 个性化家教助手，通过语音拍照交互和引导式教学，帮助学生在快乐中学习成长。

**当前状态**: Phase 2.1 用户系统和数据库集成已完成

**技术栈**: Python FastAPI + React 18 + Claude API

## 循环任务

**主任务**: 继续 Phase 2.2 学习管理系统开发，重点实现苏格拉底式引导教学功能。

### 当前需要完成的核心功能

1. **学习进度追踪系统**
   - 记录学生的学习记录（问题、答案、正确率）
   - 统计学习指标（总题数、正确率、连续答对次数）
   - 生成学习进度报告

2. **苏格拉底式引导教学**
   - 设计苏格拉底提问框架
   - 实现 Claude API 集成生成引导式响应
   - 添加响应验证系统确保不直接给答案

3. **错题本功能**
   - 记录学生的错误答案
   - 分类错误类型（概念错误、计算错误、理解错误）
   - 提供针对性的练习推荐

4. **知识点图谱**
   - 定义一年级数学知识点结构
   - 建立知识点之间的依赖关系
   - 追踪学生的知识点掌握程度

## 完成标准

循环迭代直到满足以下条件：

### 功能完整性
- [ ] 学习记录 API 完整实现并测试通过
- [ ] 苏格拉底响应生成系统可用（含验证）
- [ ] 错题本 CRUD 操作完成
- [ ] 知识点图谱数据模型建立
- [ ] 所有 API 端点集成测试通过（测试覆盖率 >80%）

### 质量标准
- [ ] 代码遵循项目规范（类型注解、文档字符串、错误处理）
- [ ] 所有数据库迁移脚本创建并测试
- [ ] API 响应时间 < 2 秒（p95）
- [ ] 单元测试通过率 100%
- [ ] 与现有认证系统集成正常

### 集成验证
- [ ] 与 Phase 2.1 的用户系统无缝集成
- [ ] 学生账户可以正常记录学习数据
- [ ] 家长可以查看孩子的学习进度
- [ ] 对话系统可以调用学习记录 API

## 技术约束

### 已有基础设施
- **数据库**: SQLAlchemy ORM，SQLite（开发）/ PostgreSQL（生产）
- **认证系统**: JWT Token 认证已实现
- **API 框架**: FastAPI with OpenAPI 自动文档
- **测试框架**: pytest + pytest-asyncio

### 必须遵循的规范
1. **API 设计**: RESTful 风格，统一响应格式
2. **错误处理**: 使用 HTTP 状态码，详细错误信息
3. **数据验证**: Pydantic 模型进行请求/响应验证
4. **数据库操作**: 使用 SQLAlchemy ORM，事务管理
5. **日志记录**: 关键操作记录日志

## 代码结构要求

### 后端目录结构
```
app/
├── api/
│   └── learning.py          # 学习管理 API 端点
├── models/
│   ├── learning_record.py   # 学习记录 Pydantic 模型
│   └── knowledge_graph.py   # 知识点图谱模型
├── services/
│   ├── socratic.py          # 苏格拉底教学服务
│   └── analytics.py         # 学习分析服务
└── utils/
    └── teaching_strategy.py # 教学策略工具
```

### 数据库表设计
- `learning_records` - 学习记录表
- `wrong_answers` - 错题本表
- `knowledge_points` - 知识点表
- `student_knowledge_mastery` - 学生知识点掌握表

## 迭代指导

### 每次迭代应该：
1. **阅读现有代码** - 理解已实现的功能
2. **检查测试状态** - 运行现有测试确保无回归
3. **实现一个功能点** - 专注单一功能
4. **编写/更新测试** - 确保新功能有测试覆盖
5. **验证集成** - 确保与现有系统兼容
6. **更新文档** - 记录变更和决策

### 不要：
- 一次性修改多个文件
- 跳过测试直接提交
- 忽略错误处理
- 破坏向后兼容性

## 成功信号

当以下条件满足时，循环可以结束：

<promise>Phase 2.2 学习管理系统核心功能完成：学习记录API、苏格拉底引导教学、错题本功能、知识点图谱均已实现并通过测试，所有API端点响应正常，测试覆盖率>80%，与现有认证系统集成验证通过。</promise>

## 紧急停止条件

如果出现以下情况，立即停止并报告：
1. 现有测试失败
2. 认证系统集成失败
3. 数据库迁移错误
4. API 响应时间超过 5 秒

---

**注意**: 本提示词会在每次迭代中重复提供。保持专注，迭代改进，直到达到完成标准。
