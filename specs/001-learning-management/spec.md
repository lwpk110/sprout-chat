# 功能规范：小芽家教 Phase 2.2 学习管理系统

**功能分支**: `001-learning-management`
**创建日期**: 2025-01-12
**状态**: 草稿
**输入**: 用户描述: "实现小芽家教 Phase 2.2 学习管理系统，包括：1. 学习记录追踪 API 2. 苏格拉底式引导教学系统 3. 错题本功能 4. 知识点图谱"

---

## 用户场景与测试 *(必须)*

### 用户故事 1 - 记录学习活动 (优先级: P1)

家长和老师需要记录学生的学习活动，以便追踪学习进度和识别学习困难点。当学生完成一道题目时，系统应该自动记录问题内容、学生的答案、是否正确、以及答题耗时，用于后续的进度分析和个性化教学。

**为什么是此优先级**: 这是整个学习管理系统的基础，所有其他功能（苏格拉底教学、错题本、知识点图谱）都依赖于学习数据的记录。没有记录就无法分析、无法个性化指导。

**独立测试**: 可以通过模拟学生答题场景进行测试 - 提交学习记录数据，验证系统是否正确保存并能够查询到记录，确保数据完整性和准确性。

**验收场景**:

1. **给定** 学生完成一道数学题 "3 + 5 = ?"，**当** 学生提交答案 "8"，**那么** 系统应该记录：问题内容、学生答案"8"、正确答案"8"、是否正确=true、答题耗时=15秒，并返回记录创建成功的确认
2. **给定** 学生完成一道数学题 "3 + 5 = ?"，**当** 学生提交错误答案 "7"，**那么** 系统应该记录错误答案，并将该题目添加到学生的错题本中，同时更新学习统计数据（正确率、连续答对次数等）
3. **给定** 系统记录了 50 道题目的学习数据，**当** 家长查看学习进度报告，**那么** 系统应该生成包含：总题数、正确率、连续答对次数、各题型正确率分布、学习时长统计等指标的报告

---

### 用户故事 2 - 引导式教学反馈 (优先级: P1)

当学生回答错误时，系统不应该直接给出正确答案，而是通过苏格拉底式提问引导学生自己思考，找到正确答案。这能培养学生的思维能力，而不是依赖记忆答案。

**为什么是此优先级**: 这是小芽家教的核心教育理念 - 引导式教学而非直接给答案。这定义了产品的教育价值和差异化竞争力，是区别于传统题库的关键功能。

**独立测试**: 可以通过测试不同的错误答案场景进行验证 - 系统收到的每个错误答案都应该返回一个引导式问题而非直接答案，可以通过人工检查或自动化验证确保响应包含引导性问题且不包含正确答案。

**验收场景**:

1. **给定** 学生回答 "3 + 5 = 7"（错误答案），**当** 系统检测到错误，**那么** 系统应该返回引导性问题，例如："让我来帮你检查一下。你一开始有 3 个苹果，妈妈又给了你 3 个，你能用手指或画图的方式数一数，3 加 3 等于多少吗？"，且响应中不能包含"答案是 8"或"正确答案是 8"等直接答案
2. **给定** 学生回答 "3 × 4 = 7"（错误答案，概念错误），**当** 系统检测到错误，**那么** 系统应该返回概念澄清的引导，例如："乘法不是加法哦。3 × 4 的意思是 3 个 4 相加，你可以试试 4 + 4 + 4 等于多少？"
3. **给定** 学生在引导后重新回答正确，**当** 学生提交 "3 × 4 = 12"，**那么** 系统应该识别这是在引导后的正确回答，并给予正向反馈："太棒了！你答对了！"
4. **给定** 学生连续三次在同一题型上出错，**当** 系统检测到这种情况，**那么** 系统应该调整引导策略，提供更具体的提示或可视化建议（例如："让我们画图来帮助理解"）

---

### 用户故事 3 - 错题本管理 (优先级: P2)

家长和学生需要查看和练习错题，以便针对性地复习薄弱知识点。系统应该自动将学生的错误答案分类整理，提供针对性的练习推荐。

**为什么是此优先级**: 错题本是学习管理系统的重要功能，能提高学习效率。但依赖于学习记录（P1）先运行，所以优先级为 P2。

**独立测试**: 可以通过创建错题记录、查询错题本、按类型筛选错题、生成练习推荐等场景进行测试，验证错题本功能能够正确记录、分类和推荐练习。

**验收场景**:

1. **给定** 学生在一周内累积了 20 道错题，**当** 家长打开错题本，**那么** 系统应该展示错题列表，按错误类型分类（计算错误 10 题、概念错误 6 题、理解错误 4 题），并支持按类型筛选
2. **给定** 学生有 10 道关于"10 以内加法"的错题，**当** 系统生成针对性练习，**那么** 系统应该推荐首先练习最常出错的题型，并生成类似但不完全相同的题目供练习
3. **给定** 学生重新答对了一道之前的错题，**当** 系统记录正确答案，**那么** 系统应该将该题目从错题本的"待复习"列表中移除，并记录"已掌握"状态

---

### 用户故事 4 - 知识点图谱追踪 (优先级: P2)

家长和老师需要了解学生对各个知识点的掌握情况，以便调整学习计划。系统应该建立一年级数学的知识点结构（如"10 以内加减法"、"20 以内加减法"、"乘法表"等），并追踪学生的掌握程度。

**为什么是此优先级**: 知识点图谱提供了学习进度的可视化视图，帮助识别学习薄弱环节。但依赖于学习记录（P1）的数据积累，所以优先级为 P2。

**独立测试**: 可以通过查看知识点图谱、检查知识点掌握程度、识别前置知识点依赖等场景进行测试，验证知识图谱能够正确反映学生的掌握情况和依赖关系。

**验收场景**:

1. **给定** 学生已完成 100 道题目，涵盖了"10 以内加法"、"20 以内加法"、"乘法表"三个知识点，**当** 家长查看知识点图谱，**那么** 系统应该显示三个知识点的掌握程度（如："10 以内加法" 90% 掌握、"20 以内加法" 70% 掌握、"乘法表" 40% 掌握）
2. **给定** 学生在"乘法表"知识点上掌握度较低，**当** 系统识别学习需求，**那么** 系统应该推荐优先学习"乘法表"的前置知识点（如"加法重复"概念），并提供相关练习
3. **给定** 学生完成了"10 以内加减法"的所有练习题且正确率 > 85%，**当** 系统评估掌握程度，**那么** 系统应该标记该知识点为"已掌握"，并解锁后续知识点（如"20 以内加减法"）

---

### 边界情况

- 当学生提交的答案为空或格式不正确时，系统如何处理？
- 当系统无法识别学生的手写或拍照题目时，系统如何处理？
- 当连续多次引导学生后学生仍无法正确回答时，系统是否需要通知家长或老师？
- 当学生短时间内（如 1 分钟）提交大量答案时，系统是否需要检测异常行为？
- 当学生切换科目（从数学切换到语文）时，系统是否需要分别记录各科目的学习进度？

---

## 需求 *(必须)*

### 功能需求

- **FR-001**: 系统必须能够记录学生的学习活动，包括：问题内容、学生答案、正确答案、是否正确、答题耗时、题目类型、难度等级、科目
- **FR-002**: 系统必须能够统计学生的学习指标，包括：总题数、正确数、错误数、正确率、连续答对次数、连续答错次数、最长连续答对记录、总学习时长
- **FR-003**: 系统必须能够生成学习进度报告，包括：指定时间范围内的学习统计、按科目的学习统计、按题型的正确率分布、按难度等级的学习表现
- **FR-004**: 系统必须在学生回答错误时提供引导式反馈，引导式反馈必须包含引导性问题而非直接答案
- **FR-005**: 系统必须实现至少 7 种引导类型：澄清（clarify）、提示（hint）、分解（break down）、可视化（visualize）、检查（check work）、替代方法（alternative method）、鼓励（encourage）
- **FR-006**: 系统必须对学生的错误答案进行分类，至少包括：计算错误、概念错误、理解错误、粗心错误
- **FR-007**: 系统必须能够查询和展示错题本，支持按科目、题型、错误类型、时间范围筛选
- **FR-008**: 系统必须能够根据错题生成针对性练习推荐，推荐题目应与原错题相关但不完全相同
- **FR-009**: 系统必须建立一年级数学的知识点结构，定义知识点之间的依赖关系（如"10 以内加减法"是"20 以内加减法"的前置知识点）
- **FR-010**: 系统必须追踪学生对每个知识点的掌握程度，掌握程度应基于：正确率、答题数量、最近表现、连续答对次数
- **FR-011**: 系统的 API 响应时间必须在可接受范围内，确保用户体验流畅
- **FR-012**: 系统必须与现有的用户认证系统集成，确保家长只能查看自己孩子的学习数据

### 关键实体

- **学习记录（Learning Record）**: 代表一次完整的答题活动，包含：问题内容、学生答案、正确答案、是否正确、答题耗时、题目类型、科目、难度等级、时间戳。与"学生"多对一关系，一个学生可以有多条学习记录。
- **错题记录（Wrong Answer Record）**: 代表一次错误的答题活动，是学习记录的子集（当"是否正确"为 false 时），额外包含：错误类型分类（计算/概念/理解/粗心）、引导式反馈内容、学生是否在引导后修正答案。
- **知识点（Knowledge Point）**: 代表一年级数学的一个知识点，包含：知识点名称、描述、所属科目、难度等级、前置知识点（依赖关系）。知识点之间形成有向无环图（DAG）结构。
- **知识点掌握（Knowledge Mastery）**: 代表学生对某个知识点的掌握程度，包含：学生ID、知识点ID、掌握度百分比（0-100）、已练习题数、正确题数、最近更新时间、掌握状态（未学习/学习中/已掌握）。是"学生"和"知识点"的多对多关联表。

---

## 成功标准 *(必须)*

### 可衡量的结果

- **SC-001**: 家长可以在 30 秒内查看孩子的学习进度报告，报告包含至少 5 项关键指标（总题数、正确率、连续答对次数、各题型正确率、学习时长）
- **SC-002**: 系统对错误答案的分类准确率必须达到 85% 以上，通过人工抽样验证（抽样 100 条错题记录）
- **SC-003**: 95% 的引导式反馈必须包含引导性问题而非直接答案，通过自动化验证系统检测
- **SC-004**: API 响应时间（p95）必须 < 200 毫秒，确保用户体验流畅
- **SC-005**: 系统必须支持至少 1000 个并发学生同时记录学习活动，性能不下降
- **SC-006**: 知识点图谱必须覆盖一年级数学的所有核心知识点（至少 20 个知识点），并正确建立知识点之间的依赖关系
- **SC-007**: 基于错题本的练习推荐必须提高学生的二次答题正确率至少 20%（即学生在第一次答错后，经过推荐练习，第二次答对率提升 20%）
- **SC-008**: 家长或老师必须在 10 秒内找到特定学生的错题，并能够按错误类型筛选

---

## 假设

- 假设学生通过已有的对话系统（Phase 2.1 已完成）提交答案，本功能只负责记录和分析，不负责答案的输入和识别
- 假设一年级数学的知识点结构由教育专家定义，系统按照预定义的结构实施，不需要动态生成知识点
- 假设"引导式反馈"使用 Claude API 生成，系统通过提示词工程确保响应符合苏格拉底式教学方法
- 假设家长已经在系统中注册并关联了学生账户，本功能基于已有的用户认证系统（Phase 2.1）进行权限控制
- 假设系统初期只支持数学科目，后续扩展到语文和英语（Phase 2.3）
- 假设学习数据至少保留 6 个月，用于生成学习进度报告和分析学习趋势
- 假设引导式反馈的生成时间在 3 秒内是可接受的（包含 Claude API 调用时间）
- 假设错误答案分类可以通过规则引擎（基于答案特征）和 AI 模型结合的方式实现，初期以规则引擎为主
